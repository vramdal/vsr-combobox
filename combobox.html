<link rel="import" href="bower_components/polymer/polymer.html">
<polymer-element name="vsr-combobox" attributes="size keypressdelay">
    <script>
        Polymer('vsr-combobox', {
            size: 20,
            keypressdelay: 700,

            domReady: function () {
                var _this = this;
                this.datalistEl = this.shadowRoot.host.querySelector("datalist");
                this.suggestionsEl = this.$["suggestions"];
                this.suggestionsEl.style.display = "none";
                this.typeBox = this.$["type-box"];
                this.typeBox.addEventListener("click", this.displaySuggestions.bind(this), false);
                this.typeBox.addEventListener("keypress", function (evt) {
                    if (_this.lastKeypressTimeout) {
                        window.clearTimeout(_this.lastKeypressTimeout);
                    }
                    _this.lastKeypressTimeout = window.setTimeout(_this.emitSearchEvent.bind(_this), _this.keypressdelay);
                });
            },
            emitSearchEvent: function() {
                this.typeBox.classList.add("waiting");
                this.fire("input-changed", {value: this.typeBox.value, callback: this.updateOptions.bind(this)});
            },
            updateOptions: function() {
                this.typeBox.classList.remove("waiting");
            },
            displaySuggestions: function() {
                if (this.suggestionsEl.style.display != "none") {
                    this.suggestionsEl.style.display = "none";
                    return;
                }
                var options = this.datalistEl.querySelectorAll("option");
                this.suggestionsEl.innerHTML = "";
                for (var i = 0; i < options.length; i++) {
                    var option = options[i];
                    this.suggestionsEl.innerHTML += "<tr id=\"" + options[i].value + "\"><td>" + options[i].innerText + "</td></tr>"
                }
                this.suggestionsEl.style.display = "table";
            }

        });
    </script>
    <template>
        <style>
            #flex1 {
                display: flex;
                align-content: stretch;
            }
            input {
                width: 100%;
            }

            /*noinspection CssUnusedSymbol*/
            input.waiting {
                background-image: url(ajax-loader.gif);
                background-position: right center;
                background-repeat: no-repeat;
            }
            #dropdownButton {
                border: outset 1px;
            }
            #suggestions {
                border-collapse: collapse;
                width: 100%;
            }
            #suggestions td {
                border: 1px solid gray;
            }
            content::content datalist {
                display: block;
                height: 100px;
            }

            content::content option {
                display: block;
                height: 50px;
                border: 1px solid black;
                width: 100px;
                color: yellow;
            }

            content::content h1 {
                color: green;
            }
        </style>
        <content></content>
        <div id="flex1">
            <input type="text" value="{{typedInput}}" id="type-box" size="{{size}}"/><span id="dropdownButton">â–¼</span>
        </div>
        <table id="suggestions"></table>
    </template>
</polymer-element>